<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snack products - Ricerca</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding:20px;
        }
        .container { max-width:1200px; margin:0 auto; background:white; border-radius:20px; padding:40px; box-shadow:0 20px 60px rgba(0,0,0,0.3); }
        h1 { text-align:center; color:#333; margin-bottom:10px; font-size:2.5em; }
        .subtitle { text-align:center; color:#666; margin-bottom:40px; font-size:1.1em; }
        .user-id-display { background:#f0f0f0; padding:10px 20px; border-radius:8px; text-align:center; margin-bottom:30px; font-size:0.9em; color:#666; }
        .products-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:30px; margin-bottom:40px; }
        .product-card { background:white; border:2px solid #e0e0e0; border-radius:15px; padding:25px; transition:all 0.3s ease; cursor:pointer; }
        .product-card:hover { transform:translateY(-5px); box-shadow:0 10px 30px rgba(0,0,0,0.15); border-color:#667eea; }
        .product-image { width:100%; height:200px; background:#f5f5f5; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:4em; margin-bottom:20px; overflow:hidden; position:relative; }
        .product-image img { width:100%; height:100%; object-fit:cover; }
        .product-image .emoji-fallback { font-size:4em; }
        .product-name { font-size:1.4em; font-weight:bold; color:#333; margin-bottom:10px; }
        .product-description { color:#666; margin-bottom:15px; line-height:1.5; }
        .product-price { font-size:1.5em; color:#667eea; font-weight:bold; margin-bottom:15px; }
        .btn-add-cart { width:100%; padding:12px; background:#667eea; color:white; border:none; border-radius:8px; font-size:1em; font-weight:bold; cursor:pointer; transition:all 0.3s ease; }
        .btn-add-cart:hover { background:#5568d3; transform:scale(1.02); }
        .btn-add-cart.added { background:#48bb78; }
        .cart-summary { background:#f8f9fa; padding:25px; border-radius:15px; margin-bottom:30px; }
        .cart-summary h2 { color:#333; margin-bottom:15px; }
        .cart-item { display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #e0e0e0; }
        .cart-total { font-size:1.5em; font-weight:bold; color:#667eea; margin-top:15px; text-align:right; }
        .admin-toggle { position:fixed; bottom:20px; right:20px; background:#333; color:white; border:none; padding:15px 25px; border-radius:50px; cursor:pointer; font-size:0.9em; box-shadow:0 5px 15px rgba(0,0,0,0.3); z-index:1000; }
        .admin-panel { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:30px; border-radius:15px; box-shadow:0 10px 40px rgba(0,0,0,0.3); max-width:90%; max-height:80vh; overflow-y:auto; z-index:2000; }
        .admin-panel.active { display:block; }
        .overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1999; }
        .overlay.active { display:block; }
        .tracking-table { width:100%; border-collapse:collapse; margin-top:20px; font-size:0.9em; }
        .tracking-table th, .tracking-table td { padding:10px; text-align:left; border-bottom:1px solid #e0e0e0; }
        .tracking-table th { background:#f8f9fa; font-weight:bold; }
        .btn-export { background:#48bb78; color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-size:1em; margin-top:20px; }
        .btn-export:hover { background:#38a169; }
        .empty-cart { text-align:center; color:#999; padding:20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõçÔ∏è Shop Demo</h1>
        <p class="subtitle"> Explore our catalog and simulate your purchase </p>
        
        <div class="user-id-display" id="userIdDisplay">Caricamento ID utente...</div>

        <div class="cart-summary">
            <h2>üõí Cart</h2>
            <div id="cartItems" class="empty-cart">Your cart is empty</div>
            <div class="cart-total" id="cartTotal"></div>
        </div>

        <div class="products-grid" id="productsGrid"></div>
    </div>

    <button class="admin-toggle" onclick="toggleAdmin()">üìä Dati Tracking</button>
    <div class="overlay" id="overlay" onclick="toggleAdmin()"></div>
    
    <div class="admin-panel" id="adminPanel">
        <h2>üìä Dashboard Tracking</h2>
        <p>Eventi registrati: <strong id="eventCount">0</strong></p>
        <button class="btn-export" onclick="exportCSV()">üì• Esporta CSV</button>
        <div style="overflow-x:auto;">
            <table class="tracking-table" id="trackingTable">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>User ID</th>
                        <th>Evento</th>
                        <th>Prodotto</th>
                        <th>Prezzo</th>
                    </tr>
                </thead>
                <tbody id="trackingBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        const products = [
            { id:1, name:'Snack 1', price:1.5, emoji:'üç™', description:'Description of snack 1', image:'https://static.galbusera.it/media/0003726_galbusera-zalet-biscotto-con-malto-e-miele-510g_550.jpeg' },
            { id:2, name:'Product 2', price:2.0, emoji:'üç™', description:'Description of snack 2', image:'https://static.galbusera.it/media/0003802_galbusera-ottocento-biscotto-di-pastafrolla-con-burro-250g_550.jpeg' },
            { id:3, name:'Product 3', price:1.75, emoji:'üç™', description:'Description of snack 3', image:'https://static.galbusera.it/media/0003717_galbusera-thefroll-biscotto-con-zucchero-di-canna-e-miele-400g_550.jpeg' },
            { id:4, name:'Product 4', price:2.2, emoji:'üç™', description:'Description of product 4', image:'https://static.galbusera.it/media/0003832_galbusera-valtellina-biscotto-con-latte-intero-fresco-pastorizzato-500g_550.jpeg' }
        ];

        let userId=null, trackingData=[], cart=[], sessionStart=Date.now();
        const GOOGLE_SHEETS_URL='https://script.google.com/macros/s/AKfycbxBrY5SfRI3r7MY9tRGTn6-eQFHh9uYQkpWQ8jdLmOZ4ltrPN6y_2L3M82gFijAAEhEnQ/exec';

        function getUserIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('uid') || urlParams.get('user_id') || urlParams.get('PROLIFIC_PID') || 'DEMO_'+Date.now();
        }

        function init() {
            userId = getUserIdFromURL();
            document.get
